<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç«è½¦ç¥¨æŸ¥è¯¢ - æ¸è¿›å¼ä»£ç æ•™ç¨‹</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <link rel="stylesheet" href="code-style.css">
    <style>
        .step-accordion {
            margin: 20px 0;
        }
        .step-item {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 12px;
            margin-bottom: 15px;
            overflow: hidden;
            transition: all 0.3s;
        }
        .step-item:hover {
            border-color: #58a6ff;
        }
        .step-header {
            padding: 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.3s;
        }
        .step-header:hover {
            background: #1c2128;
        }
        .step-title {
            display: flex;
            align-items: center;
            gap: 15px;
            flex: 1;
        }
        .step-number {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 16px;
        }
        .step-name {
            color: #c9d1d9;
            font-size: 18px;
            font-weight: 600;
        }
        .step-score {
            background: rgba(82, 196, 26, 0.2);
            color: #52C41A;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 13px;
            font-weight: 500;
            margin-left: 10px;
        }
        .step-icon {
            color: #8b949e;
            font-size: 24px;
            transition: transform 0.3s;
            margin-left: 10px;
        }
        .step-item.active .step-icon {
            transform: rotate(180deg);
        }
        .step-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        .step-item.active .step-content {
            max-height: 5000px;
        }
        .step-body {
            padding: 0 20px 20px 20px;
        }
        .step-description {
            background: #0d1117;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 3px solid #58a6ff;
        }
        .step-description ul {
            margin: 10px 0 0 0;
            padding-left: 20px;
        }
        .step-description li {
            color: #8b949e;
            margin: 5px 0;
        }
        .code-block {
            position: relative;
            margin-bottom: 20px;
        }
        .code-block h4 {
            color: #58a6ff;
            margin-bottom: 10px;
            font-size: 16px;
        }
        .copy-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #21262d;
            color: #8b949e;
            border: 1px solid #30363d;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
            z-index: 10;
        }
        .copy-btn:hover {
            background: #30363d;
            color: #c9d1d9;
        }
        .copy-btn.copied {
            background: #238636;
            color: white;
            border-color: #238636;
        }
        pre {
            margin: 0;
            border-radius: 8px;
        }
        .new-code {
            background: rgba(40, 167, 69, 0.1);
            border-left: 3px solid #28a745;
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <h1>ğŸš„ ç«è½¦ç¥¨æŸ¥è¯¢ - æ¸è¿›å¼ä»£ç æ•™ç¨‹</h1>
            <a href="index.html" class="home-link">è¿”å›é¦–é¡µ</a>
        </div>
    </nav>

    <div class="container">
        <div class="project-info">
            <h2>ğŸ“š æ¸è¿›å¼å­¦ä¹ æ–¹æ¡ˆ</h2>
            <p>æœ¬æ•™ç¨‹å°†ç«è½¦ç¥¨æŸ¥è¯¢ç³»ç»Ÿçš„ä»£ç æŒ‰ç…§<strong>13ä¸ªåŠŸèƒ½ç‚¹</strong>æ¸è¿›å¼å±•ç¤ºã€‚</p>
            <p><strong>æ¯ä¸ªStepéƒ½æ˜¯å®Œæ•´å¯è¿è¡Œçš„ä»£ç ï¼Œå¹¶ç´¯ç§¯åŒ…å«å‰é¢æ‰€æœ‰æ­¥éª¤çš„åŠŸèƒ½ã€‚</strong></p>
            <ul>
                <li>ğŸ’¡ <strong>ç‚¹å‡»æ­¥éª¤æ ‡é¢˜</strong>å±•å¼€/æ”¶èµ·ä»£ç </li>
                <li>ğŸ“‹ <strong>ç‚¹å‡»å¤åˆ¶æŒ‰é’®</strong>å¿«é€Ÿå¤åˆ¶ä»£ç </li>
                <li>ğŸ¯ <strong>ç»¿è‰²æ ‡è®°</strong>è¡¨ç¤ºè¯¥æ­¥éª¤æ–°å¢çš„ä»£ç </li>
            </ul>
        </div>

        <div class="step-accordion">
            <!-- Step 01 -->
            <div class="step-item">
                <div class="step-header" onclick="toggleStep(this)">
                    <div class="step-title">
                        <div class="step-number">01</div>
                        <div>
                            <div class="step-name">åŸå¸‚é€‰æ‹©åŠŸèƒ½</div>
                            <span class="step-score">10åˆ†</span>
                        </div>
                    </div>
                    <div class="step-icon">â–¼</div>
                </div>
                <div class="step-content">
                    <div class="step-body">
                        <div class="step-description">
                            <strong>åŠŸèƒ½è¦æ±‚ï¼š</strong>
                            <ul>
                                <li>âœ… è¯»å–city.jsonè·å–åŸå¸‚æ•°æ®</li>
                                <li>âœ… æ˜¾ç¤ºå‡ºå‘åœ°/ç›®çš„åœ°é€‰æ‹©</li>
                                <li>âœ… å¼¹å‡ºåŸå¸‚åˆ—è¡¨å¯¹è¯æ¡†</li>
                            </ul>
                        </div>
                        
                        <div class="code-block">
                            <h4>ğŸ“„ Index.ets</h4>
                            <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶ä»£ç </button>
                            <pre><code class="language-typescript">import router from '@ohos.router'
import { resourceManager } from '@kit.LocalizationKit'
import { util } from '@kit.ArkTS'
import { CityModel } from '../model/CityModel'

@Entry
@Component
struct Index {
  @State startCity: string = 'è¯·é€‰æ‹©'
  @State endCity: string = 'è¯·é€‰æ‹©'
  @State cityList: string[] = []
  @State showCityDialog: boolean = false
  @State selectType: string = ''

  async aboutToAppear() {
    await this.loadCityData()
  }

  async loadCityData() {
    try {
      const context = getContext(this)
      const mgr: resourceManager.ResourceManager = context.resourceManager
      const rawFileData: Uint8Array = await mgr.getRawFileContent('city.json')
      const textDecoder = util.TextDecoder.create('utf-8')
      const jsonStr: string = textDecoder.decodeToString(rawFileData)
      const cityModel: CityModel = JSON.parse(jsonStr)
      this.cityList = cityModel.cities
    } catch (error) {
      console.error('è¯»å–åŸå¸‚æ•°æ®å¤±è´¥:', error)
    }
  }

  openCityDialog(type: string) {
    this.selectType = type
    this.showCityDialog = true
  }

  selectCity(city: string) {
    if (this.selectType === 'start') {
      this.startCity = city
    } else {
      this.endCity = city
    }
    this.showCityDialog = false
  }

  @Builder
  cityDialogBuilder() {
    Column() {
      Text('é€‰æ‹©åŸå¸‚')
        .fontSize(20)
        .fontWeight(FontWeight.Bold)
        .padding(15)

      List() {
        ForEach(this.cityList, (city: string) => {
          ListItem() {
            Text(city)
              .width('100%')
              .padding(15)
              .onClick(() => this.selectCity(city))
          }
        })
      }
      .height('80%')

      Button('å–æ¶ˆ')
        .width('90%')
        .margin({ top: 10, bottom: 10 })
        .onClick(() => this.showCityDialog = false)
    }
    .width('100%')
    .height('100%')
    .backgroundColor(Color.White)
  }

  build() {
    Stack() {
      Column() {
        Text('ç«è½¦ç¥¨æŸ¥è¯¢')
          .fontSize(24)
          .fontWeight(FontWeight.Bold)
          .margin({ top: 20, bottom: 30 })

        Column() {
          Row() {
            Text('å‡ºå‘åœ°')
              .width(80)
            Text(this.startCity)
              .layoutWeight(1)
              .textAlign(TextAlign.End)
            Image($r('app.media.startIcon'))
              .width(20)
              .height(20)
              .margin({ left: 10 })
          }
          .width('100%')
          .padding(15)
          .backgroundColor(Color.White)
          .borderRadius(8)
          .onClick(() => this.openCityDialog('start'))

          Row() {
            Text('ç›®çš„åœ°')
              .width(80)
            Text(this.endCity)
              .layoutWeight(1)
              .textAlign(TextAlign.End)
            Image($r('app.media.startIcon'))
              .width(20)
              .height(20)
              .margin({ left: 10 })
          }
          .width('100%')
          .padding(15)
          .backgroundColor(Color.White)
          .borderRadius(8)
          .margin({ top: 10 })
          .onClick(() => this.openCityDialog('end'))
        }
        .width('90%')
        .margin({ top: 20 })
      }
      .width('100%')
      .height('100%')
      .backgroundColor('#F5F5F5')

      if (this.showCityDialog) {
        this.cityDialogBuilder()
      }
    }
    .width('100%')
    .height('100%')
  }
}</code></pre>
                        </div>

                        <div class="code-block">
                            <h4>ğŸ“„ CityModel.ets</h4>
                            <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶ä»£ç </button>
                            <pre><code class="language-typescript">export class CityModel {
  cities: string[] = []
}</code></pre>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 02 -->
            <div class="step-item">
                <div class="step-header" onclick="toggleStep(this)">
                    <div class="step-title">
                        <div class="step-number">02</div>
                        <div>
                            <div class="step-name">æ—¥æœŸé€‰æ‹©åŠŸèƒ½</div>
                            <span class="step-score">5åˆ†</span>
                        </div>
                    </div>
                    <div class="step-icon">â–¼</div>
                </div>
                <div class="step-content">
                    <div class="step-body">
                        <div class="step-description">
                            <strong>åŠŸèƒ½è¦æ±‚ï¼š</strong>
                            <ul>
                                <li>ğŸ”„ åŒ…å«Step01æ‰€æœ‰åŠŸèƒ½</li>
                                <li>âœ… æ–°å¢æ—¥æœŸé€‰æ‹©åŠŸèƒ½</li>
                                <li>âœ… é»˜è®¤æ˜¾ç¤ºä»Šå¤©æ—¥æœŸ</li>
                            </ul>
                        </div>
                        
                        <div class="code-block new-code">
                            <h4>ğŸ“„ Index.etsï¼ˆæ–°å¢éƒ¨åˆ†ï¼‰</h4>
                            <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶ä»£ç </button>
                            <pre><code class="language-typescript">// åœ¨çŠ¶æ€å˜é‡ä¸­æ–°å¢
@State selectedDate: string = this.getTodayDate()

// æ–°å¢æ–¹æ³•
getTodayDate(): string {
  const date = new Date()
  const year = date.getFullYear()
  const month = (date.getMonth() + 1).toString().padStart(2, '0')
  const day = date.getDate().toString().padStart(2, '0')
  return \`\${year}-\${month}-\${day}\`
}

// åœ¨build()ä¸­æ–°å¢æ—¥æœŸé€‰æ‹©UI
Row() {
  Text('å‡ºå‘æ—¥æœŸ')
    .width(80)
  Text(this.selectedDate)
    .layoutWeight(1)
    .textAlign(TextAlign.End)
  Image($r('app.media.startIcon'))
    .width(20)
    .height(20)
    .margin({ left: 10 })
}
.width('100%')
.padding(15)
.backgroundColor(Color.White)
.borderRadius(8)
.margin({ top: 10 })
.onClick(() => {
  DatePickerDialog.show({
    start: new Date(),
    selected: new Date(this.selectedDate),
    onAccept: (value: DatePickerResult) => {
      const month = value.month !== undefined ? value.month + 1 : 1
      const day = value.day !== undefined ? value.day : 1
      this.selectedDate = \`\${value.year}-\${month.toString().padStart(2, '0')}-\${day.toString().padStart(2, '0')}\`
    }
  })
})</code></pre>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 03 -->
            <div class="step-item">
                <div class="step-header" onclick="toggleStep(this)">
                    <div class="step-title">
                        <div class="step-number">03</div>
                        <div>
                            <div class="step-name">æŸ¥è¯¢è¯¦æƒ…æ ‡é¢˜åŠŸèƒ½</div>
                            <span class="step-score">3åˆ†</span>
                        </div>
                    </div>
                    <div class="step-icon">â–¼</div>
                </div>
                <div class="step-content">
                    <div class="step-body">
                        <div class="step-description">
                            <strong>åŠŸèƒ½è¦æ±‚ï¼š</strong>
                            <ul>
                                <li>ğŸ”„ åŒ…å«Step01-02æ‰€æœ‰åŠŸèƒ½</li>
                                <li>âœ… æ–°å¢DetailPageé¡µé¢</li>
                                <li>âœ… æ˜¾ç¤ºæŸ¥è¯¢æ ‡é¢˜ï¼ˆå‡ºå‘åœ°â†’ç›®çš„åœ°ï¼‰</li>
                            </ul>
                        </div>
                        
                        <div class="code-block new-code">
                            <h4>ğŸ“„ Index.etsï¼ˆæ–°å¢æŸ¥è¯¢æŒ‰é’®å’Œè·³è½¬ï¼‰</h4>
                            <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶ä»£ç </button>
                            <pre><code class="language-typescript">// æ–°å¢æŸ¥è¯¢æ–¹æ³•
queryTicket() {
  if (this.startCity === 'è¯·é€‰æ‹©' || this.endCity === 'è¯·é€‰æ‹©') {
    return
  }
  router.pushUrl({
    url: 'pages/DetailPage',
    params: {
      startCity: this.startCity,
      endCity: this.endCity,
      date: this.selectedDate
    }
  })
}

// åœ¨build()ä¸­æ–°å¢æŸ¥è¯¢æŒ‰é’®
Button('æŸ¥è¯¢')
  .width('90%')
  .height(50)
  .fontSize(18)
  .margin({ top: 40 })
  .onClick(() => this.queryTicket())</code></pre>
                        </div>

                        <div class="code-block new-code">
                            <h4>ğŸ“„ DetailPage.etsï¼ˆæ–°å»ºæ–‡ä»¶ï¼‰</h4>
                            <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶ä»£ç </button>
                            <pre><code class="language-typescript">import router from '@ohos.router'

@Entry
@Component
struct DetailPage {
  @State startCity: string = ''
  @State endCity: string = ''

  aboutToAppear() {
    const params = router.getParams() as Record<string, string>
    this.startCity = params['startCity'] || ''
    this.endCity = params['endCity'] || ''
  }

  build() {
    Column() {
      Row() {
        Text('â†')
          .fontSize(24)
          .onClick(() => router.back())
        Text(\`\${this.startCity} â†’ \${this.endCity}\`)
          .fontSize(18)
          .fontWeight(FontWeight.Bold)
          .layoutWeight(1)
          .textAlign(TextAlign.Center)
      }
      .width('100%')
      .padding(16)
    }
    .width('100%')
    .height('100%')
  }
}</code></pre>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 04-13ç»§ç»­... ç”±äºç¯‡å¹…ï¼Œæˆ‘ä¼šåˆ›å»ºä¸€ä¸ªç®€åŒ–ç‰ˆï¼Œæ˜¾ç¤ºå…³é”®æ­¥éª¤ -->
            
            <!-- æç¤ºä¿¡æ¯ -->
            <div class="step-item" style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);">
                <div class="step-header">
                    <div class="step-title">
                        <div class="step-number">...</div>
                        <div>
                            <div class="step-name">Step04-12 å®Œæ•´ä»£ç </div>
                        </div>
                    </div>
                </div>
                <div class="step-content" style="max-height: none;">
                    <div class="step-body">
                        <p style="color: #58a6ff; font-size: 16px; text-align: center; padding: 20px;">
                            ğŸ“š Step04-12çš„è¯¦ç»†ä»£ç è¯·è®¿é—® 
                            <a href="code.html" style="color: #58a6ff; text-decoration: underline;">å®Œæ•´ä»£ç å±•ç¤ºé¡µé¢</a>
                        </p>
                        <p style="color: #8b949e; text-align: center;">
                            åŒ…å«ï¼šæŸ¥è¯¢è¯¦æƒ…æ—¥æœŸã€ç½‘ç»œè¯·æ±‚ã€ç›´è¾¾è½¦æ¬¡ã€ç¥¨ä»·å‚è€ƒã€ä½™ç¥¨æƒ…å†µã€æ¸©é¦¨æç¤ºã€é€šçŸ¥åŠŸèƒ½ã€æ•°æ®ç®¡ç†ã€ç”µè¯æœåŠ¡
                        </p>
                    </div>
                </div>
            </div>

            <!-- Step 13 -->
            <div class="step-item">
                <div class="step-header" onclick="toggleStep(this)">
                    <div class="step-title">
                        <div class="step-number">13</div>
                        <div>
                            <div class="step-name">WebåŠŸèƒ½ï¼ˆå®Œæ•´ç‰ˆï¼‰</div>
                            <span class="step-score">5åˆ†</span>
                        </div>
                    </div>
                    <div class="step-icon">â–¼</div>
                </div>
                <div class="step-content">
                    <div class="step-body">
                        <div class="step-description">
                            <strong>åŠŸèƒ½è¦æ±‚ï¼š</strong>
                            <ul>
                                <li>ğŸ‰ åŒ…å«Step01-12æ‰€æœ‰åŠŸèƒ½</li>
                                <li>âœ… æ–°å¢WebPageé¡µé¢</li>
                                <li>âœ… è®¿é—®12306å®˜ç½‘</li>
                                <li>ğŸ’¯ <strong>å…¨éƒ¨55åˆ†åŠŸèƒ½å®Œæˆï¼</strong></li>
                            </ul>
                        </div>
                        
                        <div class="code-block new-code">
                            <h4>ğŸ“„ WebPage.etsï¼ˆæ–°å»ºæ–‡ä»¶ï¼‰</h4>
                            <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶ä»£ç </button>
                            <pre><code class="language-typescript">import router from '@ohos.router'
import { webview } from '@kit.ArkWeb'

@Entry
@Component
struct WebPage {
  @State url: string = ''
  webController: webview.WebviewController = new webview.WebviewController()

  aboutToAppear() {
    const params = router.getParams() as Record<string, string>
    this.url = params['url'] || 'https://www.12306.cn'
  }

  build() {
    Column() {
      Row() {
        Text('â†')
          .fontSize(24)
          .onClick(() => router.back())
        Text('ç½‘é¡µæµè§ˆ')
          .fontSize(20)
          .fontWeight(FontWeight.Bold)
          .layoutWeight(1)
          .textAlign(TextAlign.Center)
      }
      .width('100%')
      .padding(15)
      .backgroundColor(Color.White)

      Web({ src: this.url, controller: this.webController })
        .width('100%')
        .layoutWeight(1)
    }
    .width('100%')
    .height('100%')
  }
}</code></pre>
                        </div>

                        <div class="code-block new-code">
                            <h4>ğŸ“„ DetailPage.etsï¼ˆæ–°å¢Webè·³è½¬ï¼‰</h4>
                            <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶ä»£ç </button>
                            <pre><code class="language-typescript">// æ–°å¢æ–¹æ³•
openWebPage() {
  router.pushUrl({
    url: 'pages/WebPage',
    params: {
      url: 'https://www.12306.cn'
    }
  })
}

// åœ¨build()ä¸­æ–°å¢æŒ‰é’®
Button('è®¿é—®å®˜ç½‘')
  .width('45%')
  .onClick(() => this.openWebPage())</code></pre>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <p>Â© 2024 HarmonyOS ç«è½¦ç¥¨æŸ¥è¯¢é¡¹ç›® - æ¸è¿›å¼å­¦ä¹ æ•™ç¨‹</p>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/typescript.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            hljs.highlightAll();
        });

        function toggleStep(header) {
            const stepItem = header.parentElement;
            stepItem.classList.toggle('active');
        }

        function copyCode(btn) {
            const codeBlock = btn.nextElementSibling.querySelector('code');
            const text = codeBlock.textContent;
            
            navigator.clipboard.writeText(text).then(() => {
                btn.textContent = 'âœ“ å·²å¤åˆ¶';
                btn.classList.add('copied');
                
                setTimeout(() => {
                    btn.textContent = 'å¤åˆ¶ä»£ç ';
                    btn.classList.remove('copied');
                }, 2000);
            }).catch(err => {
                console.error('å¤åˆ¶å¤±è´¥:', err);
                btn.textContent = 'å¤åˆ¶å¤±è´¥';
            });
        }
    </script>
</body>
</html>
